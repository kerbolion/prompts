<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Flujo Conversacional IA</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <div class="formulario">
    <h2>Generador de Flujo Conversacional IA</h2>
    
    <!-- Sistema de GestiÃ³n de Proyectos -->
    <div class="projects-container">
      <h3 style="margin: 0 0 15px 0; color: #2563eb;">ğŸ“ GestiÃ³n de Proyectos</h3>
      
      <div class="flex-2">
        <div>
          <label>Proyecto actual:</label>
          <select id="selector-proyectos" onchange="cambiarProyecto(this.value)">
            <option value="">Seleccionar proyecto...</option>
          </select>
        </div>
        <div>
          <label>Nombre del proyecto:</label>
          <input type="text" id="nombre-proyecto" placeholder="Ej. Empanadas">
        </div>
      </div>
      
      <div style="margin: 15px 0;">
        <button class="boton project-btn-create" onclick="crearProyectoDesdeInput()">â• Crear Proyecto</button>
        <button class="boton project-btn-save" onclick="guardarVersion()">ğŸ’¾ Guardar VersiÃ³n</button>
        <button class="boton project-btn-delete" onclick="eliminarProyecto()">ğŸ—‘ï¸ Eliminar Proyecto</button>
        <button class="boton project-btn-import" onclick="importarProyecto()">ğŸ“¥ Importar Proyecto</button>
      </div>
      
      <div class="flex-2" style="border-top: 1px solid #d0e8ff; padding-top: 12px;">
        <div>
          <label>VersiÃ³n actual:</label>
          <select id="selector-versiones" onchange="cargarVersion(this.value)">
            <option value="">Sin versiones guardadas</option>
          </select>
        </div>
        <div>
          <button class="boton-peq export-btn" onclick="exportarPrompt()">ğŸ“„ Exportar TXT</button>
          <button class="boton-peq export-btn" onclick="exportarProyecto()">ğŸ“ Exportar Proyecto</button>
        </div>
      </div>
    </div>

    <div class="linea-form"></div>
    
    <!-- Sistema de PestaÃ±as -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button class="tab-btn active" onclick="cambiarPestana(0)">
          <span class="tab-icon">âš™ï¸</span>
          <span class="tab-text">ConfiguraciÃ³n</span>
        </button>
        <button class="tab-btn" onclick="cambiarPestana(1)">
          <span class="tab-icon">ğŸ”„</span>
          <span class="tab-text">Flujos</span>
        </button>
        <button class="tab-btn" onclick="cambiarPestana(2)">
          <span class="tab-icon">â“</span>
          <span class="tab-text">FAQ</span>
        </button>
      </div>

      <!-- PestaÃ±a 1: ConfiguraciÃ³n -->
      <div class="tab-content active" id="tab-0">
        <!-- InformaciÃ³n del Negocio -->
        <div class="config-section">
          <h3>ğŸª InformaciÃ³n del Negocio</h3>
          <div class="flex-2">
            <div>
              <label>Nombre del Negocio:</label>
              <input type="text" id="nombre_negocio" placeholder="Ej. Empanadas & Bebidas">
            </div>
            <div>
              <label>Mensaje de bienvenida:</label>
              <input type="text" id="mensaje_bienvenida" placeholder="Â¡Hola! Bienvenido...">
            </div>
          </div>
        </div>

        <!-- Contexto e Instrucciones Principales -->
        <div class="config-section">
          <h3>ğŸ¯ Contexto e Instrucciones Principales</h3>
          <label>DescripciÃ³n del rol y contexto:</label>
          <textarea id="contexto_principal" rows="3" placeholder="Ej. ActÃºa como el encargado de tomar pedidos para [nombre_negocio], por WhatsApp. Sigue este flujo de conversaciÃ³n usando mensajes concisos, emojis y negritas con asteriscos *texto*. Mantente siempre en contexto de pedidos.">ActÃºa como el encargado de tomar pedidos para "[nombre_negocio]", por WhatsApp. 
Sigue este flujo de conversaciÃ³n usando mensajes concisos, emojis y negritas con asteriscos *texto*. 
Mantente siempre en contexto de pedidos.</textarea>
        </div>

        <!-- Configuraciones Generales -->
        <div class="config-section">
          <h3>âš™ï¸ Configuraciones Generales</h3>
          
          <div class="flex-2">
            <div>
              <label>Tono de respuesta:</label>
              <input type="text" id="tono" placeholder="Ej. Profesional, cordial y claro" value="Profesional, cordial y claro">
            </div>
            <div>
              <label>Formato de respuesta:</label>
              <input type="text" id="formato_respuesta" placeholder="Ej. Respuestas breves, mÃ¡ximo 3 renglones" value="Respuestas breves, mÃ¡ximo 3 renglones, sin tecnicismos innecesarios">
            </div>
          </div>
          
          <div class="flex-2">
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="incluye_saludo" checked>
                <span class="checkmark"></span>
                Incluir saludo inicial
              </label>
            </div>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" id="incluye_despedida" checked>
                <span class="checkmark"></span>
                Incluir despedida
              </label>
            </div>
          </div>
        </div>

        <!-- Firma de Respuesta -->
        <div class="config-section">
          <h3>âœï¸ Firma de Respuesta</h3>
          <div class="flex-2">
            <div>
              <label>Contenido de la firma:</label>
              <input type="text" id="firma_contenido" placeholder="Ej. *Asistente IA*" value="*Asistente IA*">
            </div>
            <div>
              <label>PosiciÃ³n de la firma:</label>
              <select id="firma_posicion">
                <option value="inicio">Al inicio de cada respuesta</option>
                <option value="final">Al final de cada respuesta</option>
                <option value="inicio_salto" selected>Al inicio de cada respuesta, seguida de un salto de lÃ­nea</option>
                <option value="final_salto">Al final de cada respuesta, precedida de un salto de lÃ­nea</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Reglas de Comportamiento -->
        <div class="config-section">
          <h3>ğŸ“‹ Reglas de Comportamiento</h3>
          <div id="reglas-container">
            <div class="regla-item">
              <input type="text" class="regla-input" placeholder="Ej. Pregunta una cosa a la vez" value="Pregunta una cosa a la vez">
              <button class="del-regla" onclick="eliminarRegla(this)">Ã—</button>
            </div>
            <div class="regla-item">
              <input type="text" class="regla-input" placeholder="Ej. EnvÃ­a los enlaces sin formato" value="EnvÃ­a los enlaces sin formato">
              <button class="del-regla" onclick="eliminarRegla(this)">Ã—</button>
            </div>
            <div class="regla-item">
              <input type="text" class="regla-input" placeholder="Ej. Debes usar en tus respuestas el formato de la informaciÃ³n proporcionada" value="Debes usar en tus respuestas el formato de la informaciÃ³n proporcionada">
              <button class="del-regla" onclick="eliminarRegla(this)">Ã—</button>
            </div>
            <div class="regla-item">
              <input type="text" class="regla-input" placeholder="Ej. No proporciones informaciÃ³n fuera de este documento" value="No proporciones informaciÃ³n fuera de este documento">
              <button class="del-regla" onclick="eliminarRegla(this)">Ã—</button>
            </div>
            <div class="regla-item">
              <input type="text" class="regla-input" placeholder="Ej. No cambies ni omitas negritas, emojis, signos ni estructura" value="No cambies ni omitas negritas, emojis, signos ni estructura">
              <button class="del-regla" onclick="eliminarRegla(this)">Ã—</button>
            </div>
          </div>
          <button class="boton-peq" onclick="agregarRegla()">â• Agregar Regla</button>
        </div>
      </div>

      <!-- PestaÃ±a 2: GestiÃ³n de Flujos -->
      <div class="tab-content" id="tab-1">
        <div class="flujos-section">
          <h3>ğŸ”„ GestiÃ³n de Flujos</h3>
          <div class="flujos-controls">
            <div class="flex-2">
              <div>
                <label>Flujo actual:</label>
                <select id="selector-flujos" onchange="cambiarFlujo(this.value)">
                  <!-- Se llena dinÃ¡micamente -->
                </select>
              </div>
              <div>
                <label>Nombre del flujo:</label>
                <input type="text" id="nombre-flujo-actual" placeholder="Nombre del flujo" oninput="renombrarFlujo(this.value)">
              </div>
            </div>
            <div class="flujos-buttons">
              <button class="boton-peq flujo-btn" onclick="agregarFlujo()">â• Nuevo Flujo</button>
              <button class="boton-peq flujo-btn delete" onclick="eliminarFlujo()">ğŸ—‘ï¸ Eliminar Flujo</button>
            </div>
          </div>
        </div>

        <div class="pasos-title">Etapas del Flujo Actual:</div>
        <div class="pasos" id="pasos"></div>
        <button class="boton" onclick="agregarPaso();">â• Agregar Paso</button>
      </div>

      <!-- PestaÃ±a 3: Preguntas Frecuentes -->
      <div class="tab-content" id="tab-2">
        <div class="config-section">
          <h3>â“ Preguntas Frecuentes</h3>
          <div id="faq-container">
            <div class="faq-item">
              <label>Pregunta:</label>
              <input type="text" class="faq-pregunta" placeholder="Ej. Â¿CuÃ¡les son los horarios de atenciÃ³n?" value="Â¿CuÃ¡les son los horarios de atenciÃ³n?" oninput="window.actualizarPrompt()">
              <label>Respuesta:</label>
              <textarea class="faq-respuesta" rows="2" placeholder="Ej. Atendemos de lunes a domingo de 8:00 AM a 10:00 PM" oninput="window.actualizarPrompt()">Atendemos de lunes a domingo de 8:00 AM a 10:00 PM</textarea>
              <button class="del-faq" onclick="eliminarFAQ(this)">Ã—</button>
            </div>
            <div class="faq-item">
              <label>Pregunta:</label>
              <input type="text" class="faq-pregunta" placeholder="Ej. Â¿Hacen delivery?" value="Â¿Hacen delivery?" oninput="window.actualizarPrompt()">
              <label>Respuesta:</label>
              <textarea class="faq-respuesta" rows="2" placeholder="Ej. SÃ­, hacemos delivery en un radio de 5km" oninput="window.actualizarPrompt()">SÃ­, hacemos delivery en un radio de 5km</textarea>
              <button class="del-faq" onclick="eliminarFAQ(this)">Ã—</button>
            </div>
            <div class="faq-item">
              <label>Pregunta:</label>
              <input type="text" class="faq-pregunta" placeholder="Ej. Â¿CuÃ¡l es el monto mÃ­nimo para delivery?" value="Â¿CuÃ¡l es el monto mÃ­nimo para delivery?" oninput="window.actualizarPrompt()">
              <label>Respuesta:</label>
              <textarea class="faq-respuesta" rows="2" placeholder="Ej. El monto mÃ­nimo para delivery es â‚¡3,000" oninput="window.actualizarPrompt()">El monto mÃ­nimo para delivery es â‚¡3,000</textarea>
              <button class="del-faq" onclick="eliminarFAQ(this)">Ã—</button>
            </div>
          </div>
          <button class="boton-peq" onclick="agregarFAQ()">â• Agregar Pregunta Frecuente</button>
        </div>
      </div>
    </div>

    <!-- Panel de debug/informaciÃ³n -->
    <div class="debug-panel" style="margin-top: 20px;">
      <button class="boton-peq" onclick="window.listFunctions()">ğŸ“‹ Listar Funciones</button>
      <button class="boton-peq" onclick="window.loadFunctions()">ğŸ”„ Recargar Funciones</button>
    </div>
  </div>
  <div class="resultado" id="output"></div>
</div>

<!-- Cargar scripts en orden -->
<script src="helpers.js"></script>
<script src="functions/function-manager.js"></script>
<script src="flujo_gui.js"></script>
<script src="ensamblador_prompt.js"></script>
</body>
</html>